import pytest
import os
import numpy as np
from ogusa.execute import runner
CUR_PATH = os.path.abspath(os.path.dirname(__file__))
PUF_PATH = os.path.join(CUR_PATH, '../puf.csv')


eta_to_use = np.array([[[3.95156539e-03, 3.95156539e-03, 3.16125231e-03, 1.58062616e-03,
         1.58062616e-03, 1.42256354e-03, 1.58062616e-04],
        [3.97057633e-03, 3.97057633e-03, 3.17646106e-03, 1.58823053e-03,
         1.58823053e-03, 1.42940748e-03, 1.58823053e-04],
        [3.99140521e-03, 3.99140521e-03, 3.19312416e-03, 1.59656208e-03,
         1.59656208e-03, 1.43690587e-03, 1.59656208e-04],
        [4.01335125e-03, 4.01335125e-03, 3.21068100e-03, 1.60534050e-03,
         1.60534050e-03, 1.44480645e-03, 1.60534050e-04],
        [4.03533960e-03, 4.03533960e-03, 3.22827168e-03, 1.61413584e-03,
         1.61413584e-03, 1.45272226e-03, 1.61413584e-04],
        [4.05670193e-03, 4.05670193e-03, 3.24536154e-03, 1.62268077e-03,
         1.62268077e-03, 1.46041269e-03, 1.62268077e-04],
        [4.07611530e-03, 4.07611530e-03, 3.26089224e-03, 1.63044612e-03,
         1.63044612e-03, 1.46740151e-03, 1.63044612e-04],
        [4.09333545e-03, 4.09333545e-03, 3.27466836e-03, 1.63733418e-03,
         1.63733418e-03, 1.47360076e-03, 1.63733418e-04],
        [4.10837135e-03, 4.10837135e-03, 3.28669708e-03, 1.64334854e-03,
         1.64334854e-03, 1.47901369e-03, 1.64334854e-04],
        [4.12086399e-03, 4.12086399e-03, 3.29669119e-03, 1.64834560e-03,
         1.64834560e-03, 1.48351104e-03, 1.64834560e-04],
        [4.13081400e-03, 4.13081400e-03, 3.30465120e-03, 1.65232560e-03,
         1.65232560e-03, 1.48709304e-03, 1.65232560e-04],
        [4.13889370e-03, 4.13889370e-03, 3.31111496e-03, 1.65555748e-03,
         1.65555748e-03, 1.49000173e-03, 1.65555748e-04],
        [4.14547736e-03, 4.14547736e-03, 3.31638188e-03, 1.65819094e-03,
         1.65819094e-03, 1.49237185e-03, 1.65819094e-04],
        [4.15083838e-03, 4.15083838e-03, 3.32067070e-03, 1.66033535e-03,
         1.66033535e-03, 1.49430182e-03, 1.66033535e-04],
        [4.15488494e-03, 4.15488494e-03, 3.32390795e-03, 1.66195398e-03,
         1.66195398e-03, 1.49575858e-03, 1.66195398e-04],
        [4.15765147e-03, 4.15765147e-03, 3.32612118e-03, 1.66306059e-03,
         1.66306059e-03, 1.49675453e-03, 1.66306059e-04],
        [4.15882813e-03, 4.15882813e-03, 3.32706251e-03, 1.66353125e-03,
         1.66353125e-03, 1.49717813e-03, 1.66353125e-04],
        [4.15877597e-03, 4.15877597e-03, 3.32702078e-03, 1.66351039e-03,
         1.66351039e-03, 1.49715935e-03, 1.66351039e-04],
        [4.15741548e-03, 4.15741548e-03, 3.32593239e-03, 1.66296619e-03,
         1.66296619e-03, 1.49666957e-03, 1.66296619e-04],
        [4.15480168e-03, 4.15480168e-03, 3.32384134e-03, 1.66192067e-03,
         1.66192067e-03, 1.49572860e-03, 1.66192067e-04],
        [4.15094623e-03, 4.15094623e-03, 3.32075698e-03, 1.66037849e-03,
         1.66037849e-03, 1.49434064e-03, 1.66037849e-04],
        [4.14595663e-03, 4.14595663e-03, 3.31676531e-03, 1.65838265e-03,
         1.65838265e-03, 1.49254439e-03, 1.65838265e-04],
        [4.13994913e-03, 4.13994913e-03, 3.31195931e-03, 1.65597965e-03,
         1.65597965e-03, 1.49038169e-03, 1.65597965e-04],
        [4.13307009e-03, 4.13307009e-03, 3.30645607e-03, 1.65322804e-03,
         1.65322804e-03, 1.48790523e-03, 1.65322804e-04],
        [4.12533994e-03, 4.12533994e-03, 3.30027195e-03, 1.65013598e-03,
         1.65013598e-03, 1.48512238e-03, 1.65013598e-04],
        [4.11571867e-03, 4.11571867e-03, 3.29257494e-03, 1.64628747e-03,
         1.64628747e-03, 1.48165872e-03, 1.64628747e-04],
        [4.10463912e-03, 4.10463912e-03, 3.28371129e-03, 1.64185565e-03,
         1.64185565e-03, 1.47767008e-03, 1.64185565e-04],
        [4.09238220e-03, 4.09238220e-03, 3.27390576e-03, 1.63695288e-03,
         1.63695288e-03, 1.47325759e-03, 1.63695288e-04],
        [4.07842935e-03, 4.07842935e-03, 3.26274348e-03, 1.63137174e-03,
         1.63137174e-03, 1.46823457e-03, 1.63137174e-04],
        [4.06247076e-03, 4.06247076e-03, 3.24997661e-03, 1.62498830e-03,
         1.62498830e-03, 1.46248947e-03, 1.62498830e-04],
        [4.04485785e-03, 4.04485785e-03, 3.23588628e-03, 1.61794314e-03,
         1.61794314e-03, 1.45614883e-03, 1.61794314e-04],
        [4.02617428e-03, 4.02617428e-03, 3.22093943e-03, 1.61046971e-03,
         1.61046971e-03, 1.44942274e-03, 1.61046971e-04],
        [4.00535937e-03, 4.00535937e-03, 3.20428750e-03, 1.60214375e-03,
         1.60214375e-03, 1.44192937e-03, 1.60214375e-04],
        [3.98258969e-03, 3.98258969e-03, 3.18607175e-03, 1.59303588e-03,
         1.59303588e-03, 1.43373229e-03, 1.59303588e-04],
        [3.95814392e-03, 3.95814392e-03, 3.16651514e-03, 1.58325757e-03,
         1.58325757e-03, 1.42493181e-03, 1.58325757e-04],
        [3.93179647e-03, 3.93179647e-03, 3.14543717e-03, 1.57271859e-03,
         1.57271859e-03, 1.41544673e-03, 1.57271859e-04],
        [3.90383957e-03, 3.90383957e-03, 3.12307165e-03, 1.56153583e-03,
         1.56153583e-03, 1.40538224e-03, 1.56153583e-04],
        [3.87400035e-03, 3.87400035e-03, 3.09920028e-03, 1.54960014e-03,
         1.54960014e-03, 1.39464013e-03, 1.54960014e-04],
        [3.84196877e-03, 3.84196877e-03, 3.07357502e-03, 1.53678751e-03,
         1.53678751e-03, 1.38310876e-03, 1.53678751e-04],
        [3.80787789e-03, 3.80787789e-03, 3.04630231e-03, 1.52315115e-03,
         1.52315115e-03, 1.37083604e-03, 1.52315115e-04],
        [3.77185201e-03, 3.77185201e-03, 3.01748161e-03, 1.50874080e-03,
         1.50874080e-03, 1.35786672e-03, 1.50874080e-04],
        [3.73404740e-03, 3.73404740e-03, 2.98723792e-03, 1.49361896e-03,
         1.49361896e-03, 1.34425707e-03, 1.49361896e-04],
        [3.69312767e-03, 3.69312767e-03, 2.95450213e-03, 1.47725107e-03,
         1.47725107e-03, 1.32952596e-03, 1.47725107e-04],
        [3.64931125e-03, 3.64931125e-03, 2.91944900e-03, 1.45972450e-03,
         1.45972450e-03, 1.31375205e-03, 1.45972450e-04],
        [3.60766197e-03, 3.60766197e-03, 2.88612958e-03, 1.44306479e-03,
         1.44306479e-03, 1.29875831e-03, 1.44306479e-04],
        [3.56285967e-03, 3.56285967e-03, 2.85028773e-03, 1.42514387e-03,
         1.42514387e-03, 1.28262948e-03, 1.42514387e-04],
        [3.51155021e-03, 3.51155021e-03, 2.80924016e-03, 1.40462008e-03,
         1.40462008e-03, 1.26415807e-03, 1.40462008e-04],
        [3.45670257e-03, 3.45670257e-03, 2.76536205e-03, 1.38268103e-03,
         1.38268103e-03, 1.24441292e-03, 1.38268103e-04],
        [3.40163241e-03, 3.40163241e-03, 2.72130593e-03, 1.36065297e-03,
         1.36065297e-03, 1.22458767e-03, 1.36065297e-04],
        [3.34480304e-03, 3.34480304e-03, 2.67584243e-03, 1.33792122e-03,
         1.33792122e-03, 1.20412909e-03, 1.33792122e-04],
        [3.28292059e-03, 3.28292059e-03, 2.62633647e-03, 1.31316824e-03,
         1.31316824e-03, 1.18185141e-03, 1.31316824e-04],
        [3.21650788e-03, 3.21650788e-03, 2.57320631e-03, 1.28660315e-03,
         1.28660315e-03, 1.15794284e-03, 1.28660315e-04],
        [3.14624315e-03, 3.14624315e-03, 2.51699452e-03, 1.25849726e-03,
         1.25849726e-03, 1.13264753e-03, 1.25849726e-04],
        [3.07157839e-03, 3.07157839e-03, 2.45726271e-03, 1.22863136e-03,
         1.22863136e-03, 1.10576822e-03, 1.22863136e-04],
        [2.99199285e-03, 2.99199285e-03, 2.39359428e-03, 1.19679714e-03,
         1.19679714e-03, 1.07711743e-03, 1.19679714e-04],
        [2.90744259e-03, 2.90744259e-03, 2.32595407e-03, 1.16297703e-03,
         1.16297703e-03, 1.04667933e-03, 1.16297703e-04],
        [2.81749792e-03, 2.81749792e-03, 2.25399834e-03, 1.12699917e-03,
         1.12699917e-03, 1.01429925e-03, 1.12699917e-04],
        [2.72138616e-03, 2.72138616e-03, 2.17710893e-03, 1.08855447e-03,
         1.08855447e-03, 9.79699019e-04, 1.08855447e-04],
        [2.61938813e-03, 2.61938813e-03, 2.09551051e-03, 1.04775525e-03,
         1.04775525e-03, 9.42979727e-04, 1.04775525e-04],
        [2.51105115e-03, 2.51105115e-03, 2.00884092e-03, 1.00442046e-03,
         1.00442046e-03, 9.03978414e-04, 1.00442046e-04],
        [2.39617674e-03, 2.39617674e-03, 1.91694139e-03, 9.58470695e-04,
         9.58470695e-04, 8.62623626e-04, 9.58470695e-05],
        [2.27487878e-03, 2.27487878e-03, 1.81990302e-03, 9.09951512e-04,
         9.09951512e-04, 8.18956361e-04, 9.09951512e-05],
        [2.14701698e-03, 2.14701698e-03, 1.71761358e-03, 8.58806792e-04,
         8.58806792e-04, 7.72926113e-04, 8.58806792e-05],
        [2.01259941e-03, 2.01259941e-03, 1.61007953e-03, 8.05039765e-04,
         8.05039765e-04, 7.24535788e-04, 8.05039765e-05],
        [1.87184833e-03, 1.87184833e-03, 1.49747867e-03, 7.48739333e-04,
         7.48739333e-04, 6.73865399e-04, 7.48739333e-05],
        [1.72541264e-03, 1.72541264e-03, 1.38033011e-03, 6.90165054e-04,
         6.90165054e-04, 6.21148549e-04, 6.90165054e-05],
        [1.57491245e-03, 1.57491245e-03, 1.25992996e-03, 6.29964979e-04,
         6.29964979e-04, 5.66968481e-04, 6.29964979e-05],
        [1.42220089e-03, 1.42220089e-03, 1.13776071e-03, 5.68880357e-04,
         5.68880357e-04, 5.11992321e-04, 5.68880357e-05],
        [1.26948236e-03, 1.26948236e-03, 1.01558589e-03, 5.07792943e-04,
         5.07792943e-04, 4.57013648e-04, 5.07792943e-05],
        [1.11831414e-03, 1.11831414e-03, 8.94651316e-04, 4.47325658e-04,
         4.47325658e-04, 4.02593092e-04, 4.47325658e-05],
        [9.71364381e-04, 9.71364381e-04, 7.77091505e-04, 3.88545752e-04,
         3.88545752e-04, 3.49691177e-04, 3.88545752e-05],
        [8.30982831e-04, 8.30982831e-04, 6.64786265e-04, 3.32393132e-04,
         3.32393132e-04, 2.99153819e-04, 3.32393132e-05],
        [6.99517695e-04, 6.99517695e-04, 5.59614156e-04, 2.79807078e-04,
         2.79807078e-04, 2.51826370e-04, 2.79807078e-05],
        [5.78728940e-04, 5.78728940e-04, 4.62983152e-04, 2.31491576e-04,
         2.31491576e-04, 2.08342418e-04, 2.31491576e-05],
        [4.69422939e-04, 4.69422939e-04, 3.75538351e-04, 1.87769176e-04,
         1.87769176e-04, 1.68992258e-04, 1.87769176e-05],
        [3.73067125e-04, 3.73067125e-04, 2.98453700e-04, 1.49226850e-04,
         1.49226850e-04, 1.34304165e-04, 1.49226850e-05],
        [2.90043322e-04, 2.90043322e-04, 2.32034658e-04, 1.16017329e-04,
         1.16017329e-04, 1.04415596e-04, 1.16017329e-05],
        [2.20585214e-04, 2.20585214e-04, 1.76468171e-04, 8.82340856e-05,
         8.82340856e-05, 7.94106770e-05, 8.82340856e-06],
        [1.63827444e-04, 1.63827444e-04, 1.31061955e-04, 6.55309777e-05,
         6.55309777e-05, 5.89778799e-05, 6.55309777e-06],
        [1.18543187e-04, 1.18543187e-04, 9.48345498e-05, 4.74172749e-05,
         4.74172749e-05, 4.26755474e-05, 4.74172749e-06]]])

@pytest.mark.full_run
@pytest.mark.parametrize('frisch', [0.3, 0.4, 0.62],
                         ids=['Frisch 0.3', 'Frisch 0.4', 'Frisch 0.6'])
def test_frisch(frisch):
    output_base = os.path.join(CUR_PATH, "OUTPUT")
    input_dir = os.path.join(CUR_PATH, "OUTPUT")
    user_params = {'frisch': frisch, 'debt_ratio_ss': 1.0,
                   'eta': eta_to_use}
    runner(output_base=output_base, baseline_dir=input_dir, test=False,
           time_path=False, baseline=True, user_params=user_params,
           run_micro=False, data=PUF_PATH)


@pytest.mark.full_run
@pytest.mark.parametrize('g_y_annual', [0.0, 0.04],
                         ids=['0.0', '0.04'])
def test_gy(g_y_annual):
    output_base = os.path.join(CUR_PATH, "OUTPUT")
    input_dir = os.path.join(CUR_PATH, "OUTPUT")
    user_params = {'frisch': 0.41, 'debt_ratio_ss': 1.0,
                   'g_y_annual': g_y_annual, 'eta': eta_to_use}
    runner(output_base=output_base, baseline_dir=input_dir, test=False,
           time_path=False, baseline=True, user_params=user_params,
           run_micro=False, data=PUF_PATH)
